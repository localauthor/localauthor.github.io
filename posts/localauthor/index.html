<!DOCTYPE html>

<html data-color-scheme="light">
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Emacs · . local author .</title>



<link rel="stylesheet" href="/css/rocinante.css" />

<link rel="shortcut icon" href=".favicon.png">

<body>
    <header><h2>
  
  <a href="/">‹ . local author .</a>
  
</h2>
<p class="horizontal-links"><a href="/feed"
     
     
     >RSS</a><a href="/categories"
     
     
     >Categories</a><a href="/about"
     
     
     >About</a></p>

<about>
  : notes on place, literature, history, and method :
</about>



<hr>
<br>
</header>
    <main>

    <div class="post">
        <div class="title-group">
            <div class="title">
                <h1>Emacs</h1>
            </div>
            <article class="content">
            <h2 id="zk-video-scripts">ZK Video Scripts</h2>
<h3 id="getting-started-hydra-and-inbox"><span class="org-todo done DONE">DONE</span> Getting Started - Hydra and Inbox</h3>
<ul>
<li>hydra
<ul>
<li>entry point, bound to &ldquo;C-z&rdquo;</li>
</ul>
</li>
<li>entry notes
<ul>
<li>inbox</li>
</ul>
</li>
<li>functions
<ul>
<li>go-to functions</li>
<li>note count</li>
<li>nested hydra for ebib</li>
</ul>
</li>
<li>create new note</li>
</ul>
<h3 id="quickly-find-and-insert-links-with-embark"><span class="org-todo done DONE">DONE</span> Quickly Find and Insert Links, with Embark</h3>
<ul>
<li>
<p>find-file</p>
<ul>
<li>when I am reading through a note and I have a sense that there is something worth linking to, I want to find that target note without a whole lot fuss
<ul>
<li>without breaking too far out of the task at hand</li>
</ul>
</li>
<li>here I&rsquo;m reading a note and see some business about volcanoes
<ul>
<li>and I know I&rsquo;ve got some notes somewhere that deal with volcanoes, but I can&rsquo;t exactly remember where or what they&rsquo;re called so&hellip;</li>
</ul>
</li>
<li>the first thing i reach for zk-find-file, a pretty general tool
<ul>
<li>searches by titles</li>
</ul>
</li>
<li>&ldquo;volcano&rdquo;, leads to notes I don&rsquo;t really want</li>
<li>so, i use:</li>
</ul>
</li>
<li>
<p>find-file-by-full-text-search</p>
<ul>
<li>shows notes that have the search string in the body of the note</li>
<li>and here are a bunch of notes – and maybe I know by the title that this one is what I want to add</li>
</ul>
</li>
<li>
<p>you might be thinking, find-file is how you open a note</p>
<ul>
<li>but you said you want to add a link to a note</li>
<li>so what are you going to do now?</li>
</ul>
</li>
<li>
<p>well – I could remember the title of the note I want, then call zk-insert-link</p>
</li>
<li>
<p>but that&rsquo;s some extract business that I don&rsquo;t want to deal with, especially when I&rsquo;ve already found the note with one function — I don&rsquo;t want to have to find it <em>again</em> with another function</p>
<ul>
<li>this is where Embark comes in
<ul>
<li>if you&rsquo;re not familiar with embark:
<ul>
<li>it&rsquo;s a package that allows you to perform alternative actions on the item at point, even within the context of another action
<ul>
<li><a href="https://github.com/oantolin/embark" target="_blank">https://github.com/oantolin/embark</a></li>
<li><a href="https://karthinks.com/software/fifteen-ways-to-use-embark/" target="_blank">https://karthinks.com/software/fifteen-ways-to-use-embark/</a></li>
</ul>
</li>
<li>so in the middle of find file, if I want to do something different to a file, embark has a whole list of actions that you can do on files that it makes accessible through the command &rsquo;embark-act'</li>
<li>it offers a sort of submenu of commands</li>
<li>zk adds its own commands to this submenu</li>
<li>embark is sort of like a right click feature</li>
<li>in the context of a file, zk allows you to insert a link or copy a link</li>
</ul>
</li>
</ul>
</li>
<li>in this case, I want to insert a link
<ul>
<li>so I do embark-act (C-,) and then here are the list of possible actions
<ul>
<li>the quick key for insert is i</li>
<li>so I can just do embark-act i, and there it goes</li>
</ul>
</li>
</ul>
</li>
<li>do Volney
<ul>
<li>find file shows one i want to insert</li>
<li>be more thorough, look for more files
<ul>
<li>here&rsquo;s one: but the point isn&rsquo;t where I want</li>
<li>so instead of doing embark act i, I do embark-act k, which copies the link and title</li>
<li>and I can yank it into the buffer where I want it</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>so that&rsquo;s it</p>
<ul>
<li>quick, on the fly finding and insert links</li>
</ul>
</li>
<li>
<p>I&rsquo;ll show more with embark in a separate video, because there is much more</p>
</li>
<li>
<p>but next time we&rsquo;ll look at even richer searching capabilities, using grep, consult, and zk-index</p>
</li>
</ul>
<h3 id="zk-search">zk-search</h3>
<ul>
<li>{2,1,d,2} 202202200949</li>
<li>in the last video showed how I use find-file to quickly find and insert links</li>
<li>this one shows how I do more in-depth searching, using zk-search and related functions and then also the package zk-index
<ul>
<li>if you are using zk and not zk-index, then you&rsquo;re missing out on an interface that is key to my own work, which makes me happy, because it justifies the work I put into making it</li>
<li>so I&rsquo;ll showcase how it&rsquo;s useful to me, specifically in the context of searching</li>
</ul>
</li>
<li>So I showed zk-find-file-by-full-title, which is a function I use most often when I&rsquo;m in the middle of something and I just want to see <em>IF</em> I have notes containing a specific word or phrase; I just want to know, does my archive contain notes that mention this thing, whatever it is
<ul>
<li>periphery</li>
<li>peripher[y|ie|al]</li>
<li>If I have a lot, the minibuffer isn&rsquo;t a great place to browse through those results</li>
<li>so we&rsquo;re in business; but I want to see what those notes contain, to see if they&rsquo;re relevant</li>
</ul>
</li>
<li>so, first thing is zk-search
<ul>
<li>which is an interactive command that calls whatever function the variable zk-search-function is set to</li>
<li>zk-grep
<ul>
<li>by default that is the function zk-grep, which is a wrapper around rgrep, that searches for a regular expression in your zk-directory, and shows the results in a grep buffer</li>
<li>since I&rsquo;ve already searched for what we want in zk-find-file-by-full-title we can use M-p to go back in the history, since all the search functions use the same history variable, zk-search-history</li>
<li>so if you haven&rsquo;t changed the default setting, and call zk-search
<ul>
<li>but you can also call zk-grep as a command</li>
<li>and I&rsquo;ll show why this is useful in a bit</li>
</ul>
</li>
<li>show wgrep — for misspellings for example; or a tag that you want to change uniformly across all notes; or a citekey</li>
</ul>
</li>
<li>zk-consult-grep
<ul>
<li>if you use Consult, you can load the package zk-consult and set the zk-search-function to zk-consult-grep
<ul>
<li>then you get a nice interface to grep results</li>
<li>if you use embark, you can emb[ark-export to a normal grep buffer</li>
</ul>
</li>
<li>two different ways to get the same place, depending on your preferences</li>
<li>zk-consult-grep can also be used as a command, so you can just call it directly</li>
</ul>
</li>
<li>I use both - sometimes I know I want a grep buffer, something that will stick around, that I can browse through, so I just go straight for zk-grep</li>
<li>sometimes I want to get where I&rsquo;m going, and call zk-consult-grep for the quick minibuffer access</li>
<li>I have both easily accessible in my hydra
<ul>
<li>be aware: consult-grep has it&rsquo;s own history</li>
</ul>
</li>
<li>the idea behind zk is to provide low level functions that stay out of your way, that can be built on to facilitate what works for you</li>
</ul>
</li>
<li>zk-xref</li>
<li>with that in mind, if you want to use a different search facility, other than grep, you can
<ul>
<li>for example, built in xref</li>
<li>zk-xref command is in zk-extras</li>
<li>since zk-search-function can be set to any function that takes a string, you can set it to zk-xref and off you go</li>
</ul>
</li>
<li>tags work the same way
<ul>
<li>the interface prompts you with all the tags in your files
<ul>
<li>zk-tag-search-function</li>
<li>zk-tag-search</li>
<li>zk-consult-grep-tag-search</li>
</ul>
</li>
</ul>
</li>
<li>ZK-Index
<ul>
<li>one limitation of grep is that there is no boolean AND operator</li>
<li>search</li>
<li>sort - with large results (nature)
<ul>
<li>size</li>
<li>modified</li>
<li>created</li>
</ul>
</li>
<li>I&rsquo;ll do a separate video on ZK-Index and its companion, ZK-Desktop</li>
</ul>
</li>
</ul>
<h3 id="zk-index-and-zk-desktop">ZK-Index and ZK-Desktop</h3>
<h4 id="zk-index">ZK-Index</h4>
<ul>
<li>searching
<ul>
<li>zk-index-search</li>
<li>zk-index-focus</li>
</ul>
</li>
<li>zk and embark export to new index</li>
<li>link-hint
<ul>
<li>link-hint-aw-select</li>
<li>link-hint-preview</li>
</ul>
</li>
<li>popper</li>
</ul>
<h4 id="zk-desktop">ZK-Desktop</h4>
<ul>
<li>
<p>send to desktop</p>
<ul>
<li>from in buffer</li>
<li>from minibuffer</li>
<li>from index</li>
</ul>
</li>
<li>
<p>multiple desktops</p>
<ul>
<li>zk-index-desktop-select</li>
</ul>
</li>
<li>
<p>any major mode</p>
<ul>
<li>set zk-index-desktop-major-mode</li>
<li>org-mode</li>
<li>outline-mode</li>
</ul>
</li>
<li>
<p>actions</p>
<ul>
<li>type like normal</li>
<li>delete notes</li>
<li>copy and paste region</li>
<li>kill individual</li>
<li>rearranging notes</li>
</ul>
</li>
<li>
<p>link-hint</p>
<ul>
<li>link-hint-open</li>
<li>link-hint-aw-select</li>
<li>link-hint-preview</li>
</ul>
</li>
</ul>
<h3 id="zk-link-hint">ZK-Link-Hint</h3>
<h4 id="link-hint-open-link">link-hint-open-link</h4>
<ul>
<li>in buffer</li>
<li>in zk-index</li>
<li>in zk-desktop</li>
</ul>
<h4 id="link-hint-aw-select">link-hint-aw-select</h4>
<ul>
<li>custom avy actions</li>
<li>also in zk-index</li>
<li>and zk-desktop</li>
</ul>
<h4 id="link-hint-preview">link-hint-preview</h4>
<h3 id="zk-and-embark">ZK and Embark</h3>
<ul>
<li>
<p>call embark on zk candidates in the minibuffer</p>
<ul>
<li>insert a link</li>
<li>copy link and title</li>
<li>send to desktop</li>
<li>ace-window
<ul>
<li>embark-aw-select</li>
<li><a href="https://karthinks.com/software/fifteen-ways-to-use-embark/" target="_blank">https://karthinks.com/software/fifteen-ways-to-use-embark/</a></li>
</ul>
</li>
</ul>
</li>
<li>
<p>call on candidates in the index</p>
</li>
<li>
<p>call on candidates in the desktop</p>
</li>
<li>
<p>on links in note</p>
</li>
<li>
<p>in index</p>
</li>
<li>
<p>in desktop</p>
</li>
</ul>
<!--listend-->
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span><span style="color:#177500">;; from https://karthinks.com/software/fifteen-ways-to-use-embark/</span>
</span></span><span style="display:flex;"><span>(<span style="color:#a90d91">eval-when-compile</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#a90d91">defmacro</span> <span style="color:#000">embark-aw-select</span> (<span style="color:#000">fn</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#000">`</span>(<span style="color:#a90d91">defun</span> <span style="color:#000">,</span>(<span style="color:#000">intern</span> (<span style="color:#000">concat</span> <span style="color:#c41a16">&#34;embark-aw-select-&#34;</span> (<span style="color:#000">symbol-name</span> <span style="color:#000">fn</span>))) ()
</span></span><span style="display:flex;"><span>       (<span style="color:#a90d91">interactive</span>)
</span></span><span style="display:flex;"><span>       (<span style="color:#a90d91">with-demoted-errors</span> <span style="color:#c41a16">&#34;%s&#34;</span>
</span></span><span style="display:flex;"><span>         (<span style="color:#000">aw-switch-to-window</span> (<span style="color:#000">aw-select</span> <span style="color:#000">nil</span>))
</span></span><span style="display:flex;"><span>         (<span style="color:#000">call-interactively</span> (<span style="color:#000">symbol-function</span> <span style="color:#c41a16">&#39;,fn</span>))))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#a90d91">with-eval-after-load</span> <span style="color:#c41a16">&#34;embark&#34;</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#000">define-key</span> <span style="color:#000">embark-file-map</span> (<span style="color:#000">kbd</span> <span style="color:#c41a16">&#34;o&#34;</span>) (<span style="color:#000">embark-aw-select</span> <span style="color:#000">find-file</span>))
</span></span><span style="display:flex;"><span>  (<span style="color:#000">define-key</span> <span style="color:#000">embark-buffer-map</span> (<span style="color:#000">kbd</span> <span style="color:#c41a16">&#34;o&#34;</span>) (<span style="color:#000">embark-aw-select</span> <span style="color:#000">switch-to-buffer</span>))
</span></span><span style="display:flex;"><span>  (<span style="color:#000">define-key</span> <span style="color:#000">embark-bookmark-map</span> (<span style="color:#000">kbd</span> <span style="color:#c41a16">&#34;o&#34;</span>) (<span style="color:#000">embark-aw-select</span> <span style="color:#000">bookmark-jump</span>)))
</span></span></code></pre></div><h3 id="zk-citar">ZK-Citar</h3>
<p>Integration with new Citar 1.0 API</p>
<ul>
<li>set zk-citar-citekey-regexp</li>
<li>access notes via citar dialog</li>
<li>create notes via citar dialog</li>
<li>access via embark on citekey</li>
</ul>
<h3 id="zk-luhmann">ZK-Luhmann</h3>
<h3 id="expansion-customizations">Expansion, Customizations</h3>
<h2 id="popup-frames"><span class="org-todo todo DRAFT">DRAFT</span> </h2>
<p><em>This post shows how to set up Emacs popup frames in macOS, allowing quick access to Emacs functions from anywhere on your system.</em></p>
<style>.org-center { margin-left: auto; margin-right: auto; text-align: center; }</style>
<div class="org-center">
<p><strong>——————————————————————————————</strong></p>
</div>
<h2 id="popup-frames"><span class="org-todo done DONE">DONE</span> Emacs Popup Frames Anywere — MacOS Edition</h2>
<p><em>This post shows how to set up Emacs popup frames in macOS, allowing quick access to Emacs functions from anywhere on your system.</em></p>
<style>.org-center { margin-left: auto; margin-right: auto; text-align: center; }</style>
<div class="org-center">
<p><strong>——————————————————————————————</strong></p>
</div>
<p>As much as I would like to live in <a href="https://www.gnu.org/software/emacs/" target="_blank">Emacs</a> full time, I’m not quite there. But a <a href="https://protesilaos.com/codelog/2024-09-19-emacs-command-popup-frame-emacsclient/" target="_blank">recent post</a> by <a href="https://protesilaos.com" target="_blank">Protesilaos Stavrou</a> (aka Prot) is helping me bridge the gap.</p>
<p>Prot has written a short but powerful bit of code that allows you to access any piece of Emacs goodness — like <code>org-capture</code> — from outside Emacs with just one keystroke. The only requirement is that you are running in <code>server-mode</code> or using the Emacs daemon.</p>
<p>Whether you’re in a web browser, a PDF reader, or just staring at an empty desktop, your favorite Emacs command can be right at your fingertips. See <a href="https://www.youtube.com/watch?v=vbWxT8tht9A" target="_blank">Prot’s video</a> for a thorough demonstration.</p>
<p>Now, I can quickly open a PDF using citar or copy a password from my pass-store. See below for some other useful popups — org-agenda view, mu4e inbox, and a quick translation interface.</p>
<figure><img src="/images/popup-frame-citar-demo.gif">
</figure>

<h3 id="setting-up-emacs-popup-frames-in-macos">Setting Up Emacs Popup Frames in MacOS</h3>
<p>Since Prot wrote the code for use in Linux, it didn’t immediately work in MacOS. It turns out, the only necessary change was to add a <code>window-system</code> frame parameter to the popup frame. (See code below).</p>
<p>But while I was at it, I made a few additions: 1) a <code>title</code> frame parameter, which allows me to configure the popup frame size and placement through my tiling window manager, <a href="https://github.com/koekeishiya/yabai" target="_blank">yabai</a>; and 2) an optional argument that runs <code>delete-frame</code> after the main command runs. This makes it possible to call commands that are minibuffer-centric — in my case, that’s <code>citar-open-file</code> and <code>password-store-copy</code>.</p>
<p>Here’s the main code:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#a90d91">defun</span> <span style="color:#000">popup-frame-delete</span> (<span style="color:#a90d91">&amp;rest</span> <span style="color:#000">_</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#c41a16">&#34;Kill selected frame if it has parameter </span><span style="color:#c41a16">`popup-frame&#39;</span><span style="color:#c41a16">.&#34;</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#a90d91">when</span> (<span style="color:#000">frame-parameter</span> <span style="color:#000">nil</span> <span style="color:#c41a16">&#39;popup-frame</span>))
</span></span><span style="display:flex;"><span>  (<span style="color:#000">delete-frame</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#a90d91">defmacro</span> <span style="color:#000">popup-frame-define</span> (<span style="color:#000">command</span> <span style="color:#000">title</span> <span style="color:#a90d91">&amp;optional</span> <span style="color:#000">delete-frame</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#c41a16">&#34;Define interactive function to call COMMAND in frame with TITLE.&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000">`</span>(<span style="color:#a90d91">defun</span> <span style="color:#000">,</span>(<span style="color:#000">intern</span> (<span style="color:#000">format</span> <span style="color:#c41a16">&#34;popup-frame-%s&#34;</span> <span style="color:#000">command</span>)) ()
</span></span><span style="display:flex;"><span>     (<span style="color:#a90d91">interactive</span>)
</span></span><span style="display:flex;"><span>     (<span style="color:#a90d91">let*</span> ((<span style="color:#000">display-buffer-alist</span> <span style="color:#000">&#39;</span>((<span style="color:#c41a16">&#34;&#34;</span>)
</span></span><span style="display:flex;"><span>                                    (<span style="color:#000">display-buffer-full-frame</span>))))
</span></span><span style="display:flex;"><span>       (<span style="color:#000">frame</span> (<span style="color:#000">make-frame</span>
</span></span><span style="display:flex;"><span>               <span style="color:#000">&#39;</span>((<span style="color:#000">title</span> <span style="color:#000">.</span> <span style="color:#000">,</span><span style="color:#000">title</span>)
</span></span><span style="display:flex;"><span>                 (<span style="color:#000">window-system</span> <span style="color:#000">.</span> <span style="color:#000">ns</span>)
</span></span><span style="display:flex;"><span>                 (<span style="color:#000">popup-frame</span> <span style="color:#000">.</span> <span style="color:#000">t</span>)))))
</span></span><span style="display:flex;"><span>     (<span style="color:#000">select-frame</span> <span style="color:#000">frame</span>)
</span></span><span style="display:flex;"><span>     (<span style="color:#000">switch-to-buffer</span> <span style="color:#c41a16">&#34; popup-frame-hidden-buffer&#34;</span>)
</span></span><span style="display:flex;"><span>     (<span style="color:#a90d91">condition-case</span> <span style="color:#000">nil</span>
</span></span><span style="display:flex;"><span>         (<span style="color:#a90d91">progn</span>
</span></span><span style="display:flex;"><span>           (<span style="color:#000">call-interactively</span> <span style="color:#c41a16">&#39;,command</span>)
</span></span><span style="display:flex;"><span>           (<span style="color:#000">delete-other-windows</span>))
</span></span><span style="display:flex;"><span>       (<span style="color:#000">error</span> (<span style="color:#000">delete-frame</span> <span style="color:#000">frame</span>)))
</span></span><span style="display:flex;"><span>     (<span style="color:#a90d91">when</span> <span style="color:#000">,</span><span style="color:#000">delete-frame</span>
</span></span><span style="display:flex;"><span>       (<span style="color:#000">sit-for</span> <span style="color:#1c01ce">0.2</span>)
</span></span><span style="display:flex;"><span>       (<span style="color:#000">delete-frame</span> <span style="color:#000">frame</span>))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#a90d91">use-package</span> <span style="color:#000">server</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a90d91">:defer</span> <span style="color:#1c01ce">1</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a90d91">:config</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#a90d91">unless</span> (<span style="color:#000">server-running-p</span>)
</span></span><span style="display:flex;"><span>    (<span style="color:#000">server-start</span>)))
</span></span></code></pre></div><p>And here are the macro calls that define commands:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#000">popup-frame-define</span> <span style="color:#000">org-capture</span> <span style="color:#c41a16">&#34;capture-popup&#34;</span>)
</span></span><span style="display:flex;"><span>(<span style="color:#000">add-hook</span> <span style="color:#c41a16">&#39;org-capture-after-finalize-hook</span> <span style="color:#000">#&#39;</span><span style="color:#000">popup-frame-delete</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#000">popup-frame-define</span> <span style="color:#000">password-store-copy</span> <span style="color:#c41a16">&#34;minimal-popup&#34;</span> <span style="color:#c41a16">&#39;delete-frame</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#000">popup-frame-define</span> <span style="color:#000">citar-open-files</span> <span style="color:#c41a16">&#34;minimal-popup&#34;</span> <span style="color:#c41a16">&#39;delete-frame</span>)
</span></span></code></pre></div><h3 id="triggering-popups-with-keyboard-shortcuts">Triggering Popups with Keyboard Shortcuts</h3>
<p>To quickly bring up these popup frames with keyboard shortcuts, I use <a href="https://github.com/koekeishiya/skhd" target="_blank">skhd</a>, a hotkey daemon for macOS. The following configuration goes in the skhd config file:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>cmd + ctrl - c : emacsclient -e <span style="color:#c41a16">&#39;(popup-frame-org-capture)&#39;</span> <span style="color:#000">||</span> yabai -m window –focus recent
</span></span><span style="display:flex;"><span>cmd + ctrl - o : emacsclient -e <span style="color:#c41a16">&#39;(popup-frame-citar-open-files)&#39;</span> <span style="color:#000">||</span> yabai -m window –focus recent
</span></span><span style="display:flex;"><span>cmd + ctrl - p : emacsclient -e <span style="color:#c41a16">&#39;(popup-frame-password-store-copy)&#39;</span> <span style="color:#000">||</span> yabai -m window –focus recent
</span></span></code></pre></div><h3 id="managing-windows-with-yabai">Managing Windows with yabai</h3>
<p>Finally, I have configured my tiling window manager, <a href="https://github.com/koekeishiya/yabai" target="_blank">yabai</a>, to give the popup frames the desired size and placement.</p>
<p>First, the following goes in the yabai config file:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>yabai -m signal –add <span style="color:#000">event</span><span style="color:#000">=</span>window_created <span style="color:#000">app</span><span style="color:#000">=</span><span style="color:#c41a16">&#34;Emacs&#34;</span> <span style="color:#000">action</span><span style="color:#000">=</span><span style="color:#c41a16">&#34;~/.yabai-emacs-window-handler.sh&#34;</span>
</span></span></code></pre></div><p>This will run a bash script (located at ~/.yabai-emacs-window-handler.sh) every time a new Emacs frame is created. The script tells yabai how to move and resize the new frame, depending on the frame’s title. Here is that script:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span><span style="color:#633820">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#633820"></span>
</span></span><span style="display:flex;"><span><span style="color:#000">data</span><span style="color:#000">=</span><span style="color:#a90d91">$(</span>yabai -m query –windows –window <span style="color:#000">$YABAI_WINDOW_ID</span><span style="color:#a90d91">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#000">title</span><span style="color:#000">=</span><span style="color:#a90d91">$(</span><span style="color:#a90d91">echo</span> <span style="color:#000">$data</span> | jq .title<span style="color:#a90d91">)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">display</span><span style="color:#000">=</span><span style="color:#a90d91">$(</span><span style="color:#a90d91">echo</span> <span style="color:#000">$data</span> | jq .display<span style="color:#a90d91">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">if</span> <span style="color:#000">[[</span> <span style="color:#000">$title</span> <span style="color:#000">=</span>~ <span style="color:#c41a16">&#34;capture-popup&#34;</span> <span style="color:#000">&amp;&amp;</span> <span style="color:#000">$display</span> <span style="color:#000">==</span> <span style="color:#1c01ce">1</span> <span style="color:#000">]]</span>; <span style="color:#a90d91">then</span>
</span></span><span style="display:flex;"><span>yabai -m window <span style="color:#000">$YABAI_WINDOW_ID</span> –toggle float –move abs:430:230
</span></span><span style="display:flex;"><span>yabai -m window <span style="color:#000">$YABAI_WINDOW_ID</span> –resize abs:655:300
</span></span><span style="display:flex;"><span>yabai -m window <span style="color:#000">$YABAI_WINDOW_ID</span> –focus
</span></span><span style="display:flex;"><span><span style="color:#a90d91">elif</span>
</span></span><span style="display:flex;"><span><span style="color:#000">[[</span> <span style="color:#000">$title</span> <span style="color:#000">=</span>~ <span style="color:#c41a16">&#34;minimal-popup&#34;</span> <span style="color:#000">&amp;&amp;</span> <span style="color:#000">$display</span> <span style="color:#000">==</span> <span style="color:#1c01ce">1</span> <span style="color:#000">]]</span>; <span style="color:#a90d91">then</span>
</span></span><span style="display:flex;"><span>yabai -m window <span style="color:#000">$YABAI_WINDOW_ID</span> –toggle float –move abs:430:230
</span></span><span style="display:flex;"><span>yabai -m window <span style="color:#000">$YABAI_WINDOW_ID</span> –resize abs:655:200
</span></span><span style="display:flex;"><span>yabai -m window <span style="color:#000">$YABAI_WINDOW_ID</span> –focus
</span></span><span style="display:flex;"><span><span style="color:#a90d91">else</span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">false</span>
</span></span><span style="display:flex;"><span><span style="color:#a90d91">fi</span>
</span></span></code></pre></div><h3 id="additional-custom-commands">Additional Custom Commands</h3>
<p>In some cases, an Emacs command will work nicely in a popup frame right out of the box. A good case in point is <code>org-capture</code>. In other cases, I have needed to write my own custom commands. Here a few:</p>
<h4 id="google-translate-interface">Google Translate Interface</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#a90d91">defun</span> <span style="color:#000">my/translate</span> ()
</span></span><span style="display:flex;"><span>  (<span style="color:#a90d91">interactive</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#a90d91">let</span> ((<span style="color:#000">choice</span>
</span></span><span style="display:flex;"><span>         (<span style="color:#000">completing-read</span> <span style="color:#c41a16">&#34;Select: &#34;</span> <span style="color:#000">&#39;</span>(<span style="color:#c41a16">&#34;EN-&gt;LT&#34;</span> <span style="color:#c41a16">&#34;LT-&gt;EN&#34;</span>))))
</span></span><span style="display:flex;"><span>    (<span style="color:#a90d91">cond</span> ((<span style="color:#000">string=</span> <span style="color:#000">choice</span> <span style="color:#c41a16">&#34;EN-&gt;LT&#34;</span>)
</span></span><span style="display:flex;"><span>           (<span style="color:#000">google-translate-query-translate-reverse</span>))
</span></span><span style="display:flex;"><span>          ((<span style="color:#000">string=</span> <span style="color:#000">choice</span> <span style="color:#c41a16">&#34;LT-&gt;EN&#34;</span>)
</span></span><span style="display:flex;"><span>           (<span style="color:#000">google-translate-query-translate</span>)))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#000">popup-frame-define</span> <span style="color:#000">my/translate</span> <span style="color:#c41a16">&#34;minimal-popup&#34;</span>)
</span></span></code></pre></div><figure><img src="/images/popup-frame-translate-demo.gif">
</figure>

<h4 id="unread-emails-in-mu4e">Unread Emails in mu4e</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#a90d91">defun</span> <span style="color:#000">my/mu4e-unread</span> ()
</span></span><span style="display:flex;"><span>  (<span style="color:#a90d91">interactive</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#000">mu4e</span> <span style="color:#c41a16">&#39;background</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#000">mu4e-search-bookmark</span>
</span></span><span style="display:flex;"><span>   (<span style="color:#000">mu4e-get-bookmark-query</span> <span style="color:#2300ce">?u</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#000">popup-frame-define</span> <span style="color:#000">my/org-agenda</span> <span style="color:#c41a16">&#34;large-popup&#34;</span>)
</span></span></code></pre></div><p>For this, I add another “elif” to the bash script, to ensure I can see the whole inbox in the popup:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#a90d91">elif</span>
</span></span><span style="display:flex;"><span><span style="color:#000">[[</span> <span style="color:#000">$title</span> <span style="color:#000">=</span>~ <span style="color:#c41a16">&#34;large-popup&#34;</span> <span style="color:#000">&amp;&amp;</span> <span style="color:#000">$display</span> <span style="color:#000">==</span> <span style="color:#1c01ce">1</span> <span style="color:#000">]]</span>; <span style="color:#a90d91">then</span>
</span></span><span style="display:flex;"><span>yabai -m window <span style="color:#000">$YABAI_WINDOW_ID</span> –toggle float –move abs:350:130
</span></span><span style="display:flex;"><span>yabai -m window <span style="color:#000">$YABAI_WINDOW_ID</span> –resize abs:730:600
</span></span><span style="display:flex;"><span>yabai -m window <span style="color:#000">$YABAI_WINDOW_ID</span> –focus
</span></span></code></pre></div><h4 id="custom-org-agenda-view">Custom Org-Agenda View</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#a90d91">defun</span> <span style="color:#000">my/org-agenda</span> (<span style="color:#a90d91">&amp;optional</span> <span style="color:#000">p</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#a90d91">interactive</span> <span style="color:#c41a16">&#34;P&#34;</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#000">org-agenda</span> <span style="color:#000">p</span> <span style="color:#c41a16">&#34;d&#34;</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#000">org-agenda-redo-all</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#000">popup-frame-define</span> <span style="color:#000">my/org-agenda</span> <span style="color:#c41a16">&#34;large-popup&#34;</span>)
</span></span></code></pre></div><p>Just don’t forget to add a system-wide keyboard shortcut for each new command!</p>
<h2 id="zk-links"><span class="org-todo done DONE">DONE</span> Emacs: Quickly find and insert links in zk notes, with Embark</h2>
<p><em>This post continues a series of video demos in which I show how I use the Emacs package <a href="https://github.com/localauthor/zk" target="_blank">zk</a> for notetaking. The emphasis is on showcasing the practicalities of my process.</em></p>
<style>.org-center { margin-left: auto; margin-right: auto; text-align: center; }</style>
<div class="org-center">
<p><strong>——————————————————————————————</strong></p>
</div>
<iframe width="560" height="315" src="https://www.youtube.com/embed/VIPxC8TMR6s" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
<p>In <a href="https://www.youtube.com/watch?v=VIPxC8TMR6s" target="_blank">this video</a>, I show how I quickly find notes related to the note I am working on in <a href="https://github.com/localauthor/zk" target="_blank">zk</a>, and then insert the relevant links.</p>
<p>The goal is to find and insert links with a minimum of mental overhead and technical friction, so that I can keep my focus on the ideas and content of the note at hand.</p>
<p>Trying to find a single note among hundreds, and then putting the link in the right spot, could be a task unto itself — a not inconsiderable problem and distraction. But a few handy search functions, and some help from the package <a href="https://github.com/oantolin/embark" target="_blank">Embark</a>, make the matter all but effortless.</p>
<h2 id="zk-hydra"><span class="org-todo done DONE">DONE</span> Emacs: Getting started with zk, using hydra and an inbox note</h2>
<p><em>This post inaugurates a series of video demos in which I will show how I use the Emacs package <a href="https://github.com/localauthor/zk" target="_blank">zk</a> for notetaking. The emphasis will be on showcasing the practicalities of my process.</em></p>
<style>.org-center { margin-left: auto; margin-right: auto; text-align: center; }</style>
<div class="org-center">
<p><strong>——————————————————————————————</strong></p>
</div>
<style>.org-center { margin-left: auto; margin-right: auto; text-align: center; }</style>
<div class="org-center">
<iframe width="560" height="315" src="https://www.youtube.com/embed/oEgdJlojlU8" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</div>
<p>In this video I show how I use a <a href="https://github.com/abo-abo/hydra" target="_blank">hydra</a> as an entry point to my zk. The config for my hydra is here, <a href="https://github.com/localauthor/.emacs.d/blob/210531740c05104b7718b257671f2674f605f374/my-lisp/zk-setup.el#L154" target="_blank">in my dotfiles</a>.</p>
<p>I also show how I use an &ldquo;inbox&rdquo; note as a starting place for new notes. For more on the place of the inbox in a notetaking practice, see section 2.1 of <em>How to Take Smart Notes</em> by Sönke Ahrens.<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup></p>
<p>In the next video, I will show how I use the function <code>zk-find-file</code> and others in combination with <a href="https://github.com/oantolin/embark" target="_blank">Embark</a> to quickly find notes and insert links — with a minimum of effort!</p>
<h2 id="aw-select"><span class="org-todo done DONE">DONE</span> Emacs: With ace-window and link-hint, open links exactly where you want them</h2>
<p><em>This post describes how the Emacs package <a href="http://github.com/noctuid/link-hint.el" target="_blank">link-hint</a> can be combined with
<a href="https://github.com/abo-abo/ace-window" target="_blank">ace-window</a> to allow you to select, on-the-fly, which window a link will open in—instead of letting fate, or custom, or Emacs decide for you.</em></p>
<style>.org-center { margin-left: auto; margin-right: auto; text-align: center; }</style>
<div class="org-center">
<p><strong>——————————————————————————————</strong></p>
</div>
<h3 id="ace-window-is--more-than--a-fancy-window-switcher">Ace-window is (more than) a fancy window-switcher</h3>
<p>The ace-window package, written by <a href="https://github.com/abo-abo" target="_blank">abo-abo</a>, offers a handy, full-featured
alternative to the built-in window-switching function <code>other-window</code>. The
package&rsquo;s primary function—the titular =ace-window=—overlays a different
character (letter or number) over each visible Emacs window, so you can
switch to the desired window by simply pressing its assigned character. Very
useful, very sleek.</p>
<p>But ace-window is more than just a handy way to switch windows.</p>
<p>The package also offers the ability to perform an action in the selected
window before switching to it. In this regard, it follows the design of its
parent package <a href="https://github.com/abo-abo/avy" target="_blank">avy</a>—also by abo-abo. Instead of simply switching to a
window, you can <a href="https://github.com/abo-abo/ace-window#aw-dispatch-alist" target="_blank">split it first, call switch-to-buffer in it, or even close
it</a>. For a demonstration of this aspect of ace-window, see <a href="https://www.youtube.com/watch?v=I3BvGZ3m8Oo" target="_blank">this video
from Protesilaos Stavrou</a>.)</p>
<p>The greatness of ace-window truly comes through, however, when it is combined
with other packages.</p>
<h3 id="with-ace-window-and-embark-open-files-buffers-in-specified-windows">With ace-window and Embark, open files/buffers in specified windows</h3>
<p>In his <a href="https://karthinks.com/software/fifteen-ways-to-use-embark/" target="_blank">detailed write-up on using Embark</a>, Karthik Chikmagalur showcases a
killer mash-up of ace-window and Embark, demonstrating how ace-window can be
used for more than just switching windows.</p>
<p>Briefly put, Karthik shows how to incorporate ace-window&rsquo;s window-selection
function into the opening of a file or buffer from the minibuffer so that, as
he writes, &ldquo;any buffer/file/bookmark I open is always placed exactly where I
want it to be on the screen.&rdquo;</p>
<p>An example usage would be:</p>
<ol>
<li>call <code>find-file</code></li>
<li>call <code>embark-act</code> on file you wish to open</li>
<li>call <code>my/embark-ace-action-find-file</code> (this is the slightly unwieldy name
Karthik gives to the embark/ace-window function)</li>
<li>select desired window with <code>ace-window</code></li>
</ol>
<h3 id="with-ace-window-and-link-hint-follow-links-in-specified-windows">With ace-window and link-hint, follow links in specified windows</h3>
<p>Inspired by what Karthik showed was possible, I wanted to incorporate
ace-window with link-hint, so that I could choose which window a link
would open in. The result is a function called <code>link-hint-aw-select</code>:</p>
<figure><img src="/images/aw-select-demo.gif"
    alt="Figure 1: Using &rsquo;link-hint-aw-select&rsquo; to open each of the links in the top left window in a different window. First, the desired link is chosen via character overlay, courtsey of link-hint, then the desired window is chosen via character overlay, courtsey of ace-window."><figcaption>
      <p><span class="figure-number">Figure 1: </span>Using &rsquo;link-hint-aw-select&rsquo; to open each of the links in the top left window in a different window. First, the desired link is chosen via character overlay, courtsey of link-hint, then the desired window is chosen via character overlay, courtsey of ace-window.</p>
    </figcaption>
</figure>

<p>If you&rsquo;re unfamiliar, link-hint is a package that is conceptually similar to
ace-window: it puts a character overlay on visible links in a buffer so that
you can choose a link to follow by typing its assigned character. (The
conceptual similarity of link-hint and ace-window is not surprising, since
both are based on avy.)</p>
<p>Link-hint can identify a lot of different type of links, such as urls, file
paths, mailto links, org-links, buttons, and dired filenames. New link
types can also be defined by the user. (More on that later.)</p>
<p>As with avy and ace-window, link-hint allows for different actions to
performed on the chosen link. However, there are only two default actions for acting on links: open link and copy link.</p>
<p>Defining a new action is done by defining a new function, in this case the
above-mentioned <code>link-hint-aw-select</code>, which will be entry-point command for all link types:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#a90d91">defun</span> <span style="color:#000">link-hint-aw-select</span> ()
</span></span><span style="display:flex;"><span>  <span style="color:#c41a16">&#34;Use avy to open a link in a window selected with ace-window.&#34;</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#a90d91">interactive</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#a90d91">unless</span>
</span></span><span style="display:flex;"><span>      (<span style="color:#000">avy-with</span> <span style="color:#000">link-hint-aw-select</span>
</span></span><span style="display:flex;"><span>        (<span style="color:#000">link-hint</span><span style="color:#000">–</span><span style="color:#000">one</span> <span style="color:#a90d91">:aw-select</span>))
</span></span><span style="display:flex;"><span>    (<span style="color:#000">message</span> <span style="color:#c41a16">&#34;No visible links&#34;</span>)))
</span></span></code></pre></div><p>Things get more complicated very quickly, however.</p>
<p>Each action must be tailored to each different link type. Take the case of
the &ldquo;open&rdquo; action, for examples: urls open one way—in a browser—and
filepaths open another way—in a relevant application—and email addresses
open another way—in a new draft email. Each action is actually many
different actions, all roughly similar.</p>
<p>When creating a new action, then, it is necessary to make sure that each link
type is associated with a function that will perform the new action in the
appropriate way.</p>
<p>The <code>aw-select</code> action for file links is quite simple:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#a90d91">defun</span> <span style="color:#000">link-hint</span><span style="color:#000">–</span><span style="color:#000">aw-select-file-link</span> (<span style="color:#000">link</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#a90d91">with-demoted-errors</span> <span style="color:#c41a16">&#34;%s&#34;</span>
</span></span><span style="display:flex;"><span>    (<span style="color:#000">aw-switch-to-window</span> (<span style="color:#000">aw-select</span> <span style="color:#000">nil</span>))
</span></span><span style="display:flex;"><span>    (<span style="color:#000">find-file</span> <span style="color:#000">link</span>)))
</span></span></code></pre></div><p>To make the link-hint ecosystem aware of this new association of link-type,
action, and function, there is a handy macro:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#000">link-hint-define-type</span> <span style="color:#c41a16">&#39;file-link</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a90d91">:aw-select</span> <span style="color:#000">#&#39;</span><span style="color:#000">link-hint</span><span style="color:#000">–</span><span style="color:#000">aw-select-file-link</span>)
</span></span></code></pre></div><p>If different link-types behave similarly, it is possible to create a macro
of our own that will do all of the above very efficiently. This is the case with buttons and dired-filenames, for example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#a90d91">defmacro</span> <span style="color:#000">define-link-hint-aw-select</span> (<span style="color:#000">link-type</span> <span style="color:#000">fn</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#000">`</span>(<span style="color:#a90d91">progn</span>
</span></span><span style="display:flex;"><span>     (<span style="color:#000">link-hint-define-type</span> <span style="color:#c41a16">&#39;,link-type</span>
</span></span><span style="display:flex;"><span>       <span style="color:#a90d91">:aw-select</span> <span style="color:#000">#&#39;</span><span style="color:#000">,</span>(<span style="color:#000">intern</span> (<span style="color:#000">concat</span> <span style="color:#c41a16">&#34;link-hint–aw-select-&#34;</span>
</span></span><span style="display:flex;"><span>                                     (<span style="color:#000">symbol-name</span> <span style="color:#000">link-type</span>))))
</span></span><span style="display:flex;"><span>     (<span style="color:#a90d91">defun</span> <span style="color:#000">,</span>(<span style="color:#000">intern</span> (<span style="color:#000">concat</span> <span style="color:#c41a16">&#34;link-hint–aw-select-&#34;</span>
</span></span><span style="display:flex;"><span>                             (<span style="color:#000">symbol-name</span> <span style="color:#000">link-type</span>))) (<span style="color:#000">_link</span>)
</span></span><span style="display:flex;"><span>       (<span style="color:#a90d91">with-demoted-errors</span> <span style="color:#c41a16">&#34;%s&#34;</span>
</span></span><span style="display:flex;"><span>         (<span style="color:#a90d91">if</span> (<span style="color:#000">&gt;</span> (<span style="color:#000">length</span> (<span style="color:#000">aw-window-list</span>)) <span style="color:#1c01ce">1</span>)
</span></span><span style="display:flex;"><span>             (<span style="color:#a90d91">let</span> ((<span style="color:#000">window</span> (<span style="color:#000">aw-select</span> <span style="color:#000">nil</span>))
</span></span><span style="display:flex;"><span>                   (<span style="color:#000">buffer</span> (<span style="color:#000">current-buffer</span>))
</span></span><span style="display:flex;"><span>                   (<span style="color:#000">new-buffer</span>))
</span></span><span style="display:flex;"><span>               (<span style="color:#000">,</span><span style="color:#000">fn</span>)
</span></span><span style="display:flex;"><span>               (<span style="color:#a90d91">setq</span> <span style="color:#000">new-buffer</span> (<span style="color:#000">current-buffer</span>))
</span></span><span style="display:flex;"><span>               (<span style="color:#000">switch-to-buffer</span> <span style="color:#000">buffer</span>)
</span></span><span style="display:flex;"><span>               (<span style="color:#000">aw-switch-to-window</span> <span style="color:#000">window</span>)
</span></span><span style="display:flex;"><span>               (<span style="color:#000">switch-to-buffer</span> <span style="color:#000">new-buffer</span>))
</span></span><span style="display:flex;"><span>           (<span style="color:#000">link-hint-open-link-at-point</span>))))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#000">define-link-hint-aw-select</span> <span style="color:#000">button</span> <span style="color:#000">push-button</span>)
</span></span><span style="display:flex;"><span>(<span style="color:#000">define-link-hint-aw-select</span> <span style="color:#000">dired-filename</span> <span style="color:#000">dired-find-file</span>)
</span></span></code></pre></div><p>The same is <em>almost</em> the case with org-links as well, except that by default
org-links are opened using <code>find-file-other-window</code> instead of <code>find-file</code>,
meaning that the above macro wouldn&rsquo;t work properly.</p>
<p>I prefer to change this setting globally, so that org-links are opened in the
current window, by evaluating the following:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#a90d91">setf</span> (<span style="color:#000">cdr</span> (<span style="color:#000">assoc</span> <span style="color:#c41a16">&#39;file</span> <span style="color:#000">org-link-frame-setup</span>)) <span style="color:#c41a16">&#39;find-file</span>)
</span></span></code></pre></div><p>This allows me to use the macro:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#000">define-link-hint-aw-select</span> <span style="color:#000">org-link</span> <span style="color:#000">org-open-at-point</span>)
</span></span></code></pre></div><p>To leave org&rsquo;s default behavior in place globally, it is necessary to define
a function specifically for org-links, in which the behavior is changed
locally in a let-binding:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#a90d91">defun</span> <span style="color:#000">link-hint</span><span style="color:#000">–</span><span style="color:#000">aw-select-org-link</span> (<span style="color:#000">_link</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#a90d91">let</span> ((<span style="color:#000">org-link-frame-setup</span>
</span></span><span style="display:flex;"><span>         <span style="color:#000">&#39;</span>((<span style="color:#000">file</span> <span style="color:#000">.</span> <span style="color:#000">find-file</span>))))
</span></span><span style="display:flex;"><span>    (<span style="color:#a90d91">with-demoted-errors</span> <span style="color:#c41a16">&#34;%s&#34;</span>
</span></span><span style="display:flex;"><span>      (<span style="color:#a90d91">if</span> (<span style="color:#000">&gt;</span> (<span style="color:#000">length</span> (<span style="color:#000">aw-window-list</span>)) <span style="color:#1c01ce">1</span>)
</span></span><span style="display:flex;"><span>          (<span style="color:#a90d91">let</span> ((<span style="color:#000">window</span> (<span style="color:#000">aw-select</span> <span style="color:#000">nil</span>))
</span></span><span style="display:flex;"><span>                (<span style="color:#000">buffer</span> (<span style="color:#000">current-buffer</span>))
</span></span><span style="display:flex;"><span>                (<span style="color:#000">new-buffer</span>))
</span></span><span style="display:flex;"><span>            (<span style="color:#000">org-open-at-point</span>)
</span></span><span style="display:flex;"><span>            (<span style="color:#a90d91">setq</span> <span style="color:#000">new-buffer</span>
</span></span><span style="display:flex;"><span>                  (<span style="color:#000">current-buffer</span>))
</span></span><span style="display:flex;"><span>            (<span style="color:#000">switch-to-buffer</span> <span style="color:#000">buffer</span>)
</span></span><span style="display:flex;"><span>            (<span style="color:#000">aw-switch-to-window</span> <span style="color:#000">window</span>)
</span></span><span style="display:flex;"><span>            (<span style="color:#000">switch-to-buffer</span> <span style="color:#000">new-buffer</span>))
</span></span><span style="display:flex;"><span>        (<span style="color:#000">link-hint-open-link-at-point</span>)))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#000">link-hint-define-type</span> <span style="color:#c41a16">&#39;org-link</span> <span style="color:#a90d91">:aw-select</span> <span style="color:#000">#&#39;</span><span style="color:#000">link-hint</span><span style="color:#000">–</span><span style="color:#000">aw-select-org-link</span>)
</span></span></code></pre></div><p>Things are actually even a bit more complicated than this with org-links.</p>
<p>Since org handles different link-types internally, the function
<code>link-hint–aw-select-org-link</code> can also be made to handle certain org
link-types differently. For example, if you want http/https links to be
opened externally, there is no reason to call the <code>aw-select</code> behavior for
that type of org-link. This could be accomplished by including something like
the following in the function&rsquo;s &ldquo;if&rdquo; conditional:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#000">not</span> (<span style="color:#000">member</span> (<span style="color:#000">org-element-property</span> <span style="color:#a90d91">:type</span> (<span style="color:#000">org-element-context</span>))
</span></span><span style="display:flex;"><span>             <span style="color:#000">&#39;</span>(<span style="color:#c41a16">&#34;http&#34;</span> <span style="color:#c41a16">&#34;https&#34;</span>)))
</span></span></code></pre></div><p>The whole function would be:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#a90d91">defun</span> <span style="color:#000">link-hint</span><span style="color:#000">–</span><span style="color:#000">aw-select-org-link</span> (<span style="color:#000">_link</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#a90d91">let</span> ((<span style="color:#000">org-link-frame-setup</span>
</span></span><span style="display:flex;"><span>         <span style="color:#000">&#39;</span>((<span style="color:#000">file</span> <span style="color:#000">.</span> <span style="color:#000">find-file</span>))))
</span></span><span style="display:flex;"><span>    (<span style="color:#a90d91">with-demoted-errors</span> <span style="color:#c41a16">&#34;%s&#34;</span>
</span></span><span style="display:flex;"><span>      (<span style="color:#a90d91">if</span> (<span style="color:#a90d91">and</span> (<span style="color:#000">&gt;</span> (<span style="color:#000">length</span> (<span style="color:#000">aw-window-list</span>)) <span style="color:#1c01ce">1</span>)
</span></span><span style="display:flex;"><span>               (<span style="color:#000">not</span> (<span style="color:#000">member</span> (<span style="color:#000">org-element-property</span>
</span></span><span style="display:flex;"><span>                             <span style="color:#a90d91">:type</span> (<span style="color:#000">org-element-context</span>))
</span></span><span style="display:flex;"><span>                       <span style="color:#000">&#39;</span>(<span style="color:#c41a16">&#34;http&#34;</span> <span style="color:#c41a16">&#34;https&#34;</span>))))
</span></span><span style="display:flex;"><span>          (<span style="color:#a90d91">let</span> ((<span style="color:#000">window</span> (<span style="color:#000">aw-select</span> <span style="color:#000">nil</span>))
</span></span><span style="display:flex;"><span>                (<span style="color:#000">buffer</span> (<span style="color:#000">current-buffer</span>))
</span></span><span style="display:flex;"><span>                (<span style="color:#000">new-buffer</span>))
</span></span><span style="display:flex;"><span>            (<span style="color:#000">org-open-at-point</span>)
</span></span><span style="display:flex;"><span>            (<span style="color:#a90d91">setq</span> <span style="color:#000">new-buffer</span>
</span></span><span style="display:flex;"><span>                  (<span style="color:#000">current-buffer</span>))
</span></span><span style="display:flex;"><span>            (<span style="color:#000">switch-to-buffer</span> <span style="color:#000">buffer</span>)
</span></span><span style="display:flex;"><span>            (<span style="color:#000">aw-switch-to-window</span> <span style="color:#000">window</span>)
</span></span><span style="display:flex;"><span>            (<span style="color:#000">switch-to-buffer</span> <span style="color:#000">new-buffer</span>))
</span></span><span style="display:flex;"><span>        (<span style="color:#000">link-hint-open-link-at-point</span>)))))
</span></span></code></pre></div><h3 id="example-use-case-note-taking-zettelkasten-etc-dot">Example use-case: note-taking, zettelkasten, etc.</h3>
<p>I find this functionality really useful in my note-taking environment, where
each of my notes contains several links to other notes. I rarely want to
follow a link in the same window as the note where the link appears. I
typically want to leave that note where it is and open a link somewhere else.
If I have several windows arrayed around my screen, I can use
<code>link-hint-aw-select</code> to open the linked note exactly where I want it to be.</p>
<p>To use this with org, the above configuration is enough. If you use another note-taking environment, you may need to define a new link type.</p>
<p>For example, for use with my own Zettelkasten package <a href="https://github.com/localauthor/zk" target="_blank">zk</a>, I define a new link
type <code>zk-link</code> and a function <code>zk-link-hint-aw-select</code>, along with other
functions necessary to fully incorporate a new link type into the link-hint
system:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-emacs-lisp" data-lang="emacs-lisp"><span style="display:flex;"><span>(<span style="color:#a90d91">defun</span> <span style="color:#000">zk-link-hint</span><span style="color:#000">–</span><span style="color:#000">zk-link-at-point-p</span> ()
</span></span><span style="display:flex;"><span>  <span style="color:#c41a16">&#34;Return the ID for the zk-link at the point or nil.&#34;</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#a90d91">and</span> (<span style="color:#000">zk</span><span style="color:#000">–</span><span style="color:#000">id-at-point</span>)
</span></span><span style="display:flex;"><span>       (<span style="color:#000">thing-at-point-looking-at</span> <span style="color:#000">zk-link-regexp</span>)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#a90d91">defun</span> <span style="color:#000">zk-link-hint</span><span style="color:#000">–</span><span style="color:#000">next-zk-link</span> (<span style="color:#000">bound</span>)
</span></span><span style="display:flex;"><span>  <span style="color:#c41a16">&#34;Find the unext zk-link.
</span></span></span><span style="display:flex;"><span><span style="color:#c41a16">Only search the range between just after the point and BOUND.&#34;</span>
</span></span><span style="display:flex;"><span>  (<span style="color:#000">link-hint</span><span style="color:#000">–</span><span style="color:#000">next-regexp</span> <span style="color:#000">zk-id-regexp</span> <span style="color:#000">bound</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#a90d91">defun</span> <span style="color:#000">link-hint</span><span style="color:#000">–</span><span style="color:#000">aw-select-zk-link</span> (<span style="color:#000">id</span>)
</span></span><span style="display:flex;"><span>  (<span style="color:#a90d91">with-demoted-errors</span> <span style="color:#c41a16">&#34;%s&#34;</span>
</span></span><span style="display:flex;"><span>    (<span style="color:#a90d91">if</span> (<span style="color:#000">&gt;</span> (<span style="color:#000">length</span> (<span style="color:#000">aw-window-list</span>)) <span style="color:#1c01ce">1</span>)
</span></span><span style="display:flex;"><span>        (<span style="color:#a90d91">let</span> ((<span style="color:#000">window</span> (<span style="color:#000">aw-select</span> <span style="color:#000">nil</span>))
</span></span><span style="display:flex;"><span>              (<span style="color:#000">buffer</span> (<span style="color:#000">current-buffer</span>))
</span></span><span style="display:flex;"><span>              (<span style="color:#000">new-buffer</span>))
</span></span><span style="display:flex;"><span>          (<span style="color:#000">zk-follow-link-at-point</span> <span style="color:#000">id</span>)
</span></span><span style="display:flex;"><span>          (<span style="color:#a90d91">setq</span> <span style="color:#000">new-buffer</span>
</span></span><span style="display:flex;"><span>                (<span style="color:#000">current-buffer</span>))
</span></span><span style="display:flex;"><span>          (<span style="color:#000">switch-to-buffer</span> <span style="color:#000">buffer</span>)
</span></span><span style="display:flex;"><span>          (<span style="color:#000">aw-switch-to-window</span> <span style="color:#000">window</span>)
</span></span><span style="display:flex;"><span>          (<span style="color:#000">switch-to-buffer</span> <span style="color:#000">new-buffer</span>))
</span></span><span style="display:flex;"><span>      (<span style="color:#000">link-hint-open-link-at-point</span>))))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#000">link-hint-define-type</span> <span style="color:#c41a16">&#39;zk-link</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a90d91">:next</span> <span style="color:#000">#&#39;</span><span style="color:#000">zk-link-hint</span><span style="color:#000">–</span><span style="color:#000">next-zk-link</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a90d91">:at-point-p</span> <span style="color:#000">#&#39;</span><span style="color:#000">zk-link-hint</span><span style="color:#000">–</span><span style="color:#000">zk-link-at-point-p</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a90d91">:open</span> <span style="color:#000">#&#39;</span><span style="color:#000">zk-follow-link-at-point</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a90d91">:copy</span> <span style="color:#000">#&#39;</span><span style="color:#000">kill-new</span>
</span></span><span style="display:flex;"><span>  <span style="color:#a90d91">:aw-select</span> <span style="color:#000">#&#39;</span><span style="color:#000">link-hint</span><span style="color:#000">–</span><span style="color:#000">aw-select-zk-link</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>(<span style="color:#a90d91">push</span> <span style="color:#c41a16">&#39;link-hint-zk-link</span> <span style="color:#000">link-hint-types</span>)
</span></span></code></pre></div><p>Even though link-hint can be a bit complex under the hood, it is quite
effortless, even elegant, when put in combination with ace-window. Give
it a try and puzzle over what you had done so long without it.</p>
<div class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1">
<p>Sönke Ahrens, <i>How to Take Smart Notes: One Simple Technique to Boost Writing, Learning and Thinking</i> (North Charleston, SC: CreateSpace, 2017).&#160;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</div>

        </article>
            
    </article>


    </main>
    <footer><hr>

</footer>
  </body>
</html>
